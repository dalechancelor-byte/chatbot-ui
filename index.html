<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>FAQ Chatbot â€“ Embed Proxy</title>
  <style>
    html, body { height: 100%; }
    body { margin: 0; background: #fff; color: #111; font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, "Helvetica Neue", Arial, "Noto Sans", sans-serif; }
    .frame-wrap { width: 100%; max-width: 1200px; margin: 0 auto; }
    /* Start with a sensible height so there are no double scrollbars before first message */
    iframe { display: block; width: 100%; height: 70vh; min-height: 500px; border: 0; border-radius: 12px; }
    @media (max-width: 640px) { iframe { border-radius: 0; } }
    noscript { display:block; padding: 12px; background:#fee2e2; color:#7f1d1d; font-size:14px; }
  </style>
</head>
<body>
  <div class="frame-wrap">
    <iframe id="faqFrame" title="FAQ Chatbot" allow="clipboard-read; clipboard-write" referrerpolicy="strict-origin-when-cross-origin"></iframe>
    <noscript>This embed adjusts height dynamically. Please enable JavaScript to see the full experience.</noscript>
  </div>

  <script>
    (function(){
      // --- Config ------------------------------------------------------------
      const CHILD_URL = "https://dalechancelor-byte.github.io/FAQ/"; // your chatbot page
      const CHILD_ORIGIN = new URL(CHILD_URL).origin;
      const MIN_H = 400;               // clamp heights for safety
      const MAX_H = 2400;

      // Pass through any query params from this proxy to the child (optional)
      const passthrough = window.location.search || "";

      const frame = document.getElementById("faqFrame");
      frame.src = CHILD_URL + passthrough;

      // Listen for height messages from the child and resize the iframe
      window.addEventListener("message", (e) => {
        if (e.origin !== CHILD_ORIGIN) return;            // security: only trust child origin
        const msg = e.data || {};
        if (typeof msg !== "object" || msg.type !== "FAQ_EMBED_SIZE") return;
        if (e.source !== frame.contentWindow) return;     // ensure it came from our iframe
        if (msg.height) {
          const h = Math.max(MIN_H, Math.min(MAX_H, Number(msg.height) || 0));
          frame.style.height = h + "px";
        }
      });

      // Fallback: adjust on viewport changes (child also sends after resize)
      window.addEventListener("resize", () => {
        // no-op; kept for future enhancements
      });
    })();
  </script>
</body>
</html>
